generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mongodb"
    url      = env("DATABASE_URL")
}

enum Priority {
    LOW
    MEDIUM
    HIGH
    URGENT
}

enum Status {
    TODO
    IN_PROGRESS
    REVIEW
    COMPLETED
}

enum NotificationType {
    TASK_ASSIGNED
}

model User {
    id           String @id @default(uuid()) @map("_id")
    name         String
    email        String @unique
    passwordHash String

    // relations
    tasksCreated  Task[]         @relation("TaskCreator")
    tasksAssigned Task[]         @relation("TaskAssignee")
    notifications Notification[]
    sessions      Session[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Task {
    id          String   @id @default(uuid()) @map("_id")
    title       String
    description String
    dueDate     DateTime
    priority    Priority
    status      Status

    creatorId    String
    assignedToId String

    creator  User @relation("TaskCreator", fields: [creatorId], references: [id])
    assignee User @relation("TaskAssignee", fields: [assignedToId], references: [id])

    createdAt     DateTime       @default(now())
    updatedAt     DateTime       @updatedAt
    notifications Notification[]
}

model Notification {
    id String @id @default(uuid()) @map("_id")

    userId String
    taskId String

    type    NotificationType
    message String
    isRead  Boolean          @default(false)

    user User @relation(fields: [userId], references: [id])
    task Task @relation(fields: [taskId], references: [id])

    createdAt DateTime @default(now())

    @@index([userId, isRead])
}

model Session {
    id           String   @id @default(uuid()) @map("_id")
    userId       String
    refreshToken String   @unique
    userAgent    String?
    ipAddress    String?
    expiresAt    DateTime

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())

    @@index([userId])
}
